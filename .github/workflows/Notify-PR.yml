name: Notify Slack on PR with Bot

on:
  pull_request:
    types: [opened, reopened, review_requested]

jobs:
  Notify-Slack:
    runs-on: ubuntu-latest

    steps:
      - name: Send Slack Message with Mention
        env:
          SLACK_BOT_TOKEN: ${{ secrets.SLACK_BOT_TOKEN }}
          SLACK_CHANNEL_ID: ${{ secrets.SLACK_CHANNEL_ID }}
        run: |
          # GitHub ë¦¬ë·°ì–´ ì´ë¦„ â†’ ìŠ¬ë™ ì‚¬ìš©ì ID ìˆ˜ë™ ë§¤í•‘
          declare -A user_map
          user_map["Park-Jae-Min"]="U096UP6APFF"

          REVIEWERS=$(echo '${{ toJson(github.event.pull_request.requested_reviewers) }}' | jq -r '.[].login')
          
          MENTIONS=""
          for reviewer in $REVIEWERS; do
            SLACK_ID="${user_map[$reviewer]}"
            if [ -n "$SLACK_ID" ]; then
              MENTIONS+="<@$SLACK_ID> "
            fi
          done

          TEXT="ğŸ“£ $MENTIONS ë¦¬ë·°ê°€ ìš”ì²­ë˜ì—ˆìŠµë‹ˆë‹¤!\nPR ì œëª©: *${{ github.event.pull_request.title }}*\nğŸ”— ${{ github.event.pull_request.html_url }}"

          curl -X POST https://slack.com/api/chat.postMessage \
            -H "Authorization: Bearer $SLACK_BOT_TOKEN" \
            -H 'Content-type: application/json' \
            --data "{
              \"channel\": \"$SLACK_CHANNEL_ID\",
              \"text\": \"$TEXT\"
            }"
